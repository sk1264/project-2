<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./imageUploader.css" />
    <title>Document</title>
  </head>
  <body>
    <div class="form-control">
      <h1>please select an image</h1>
      <form id="form" enctype="multipart/form-data">
        <label for="title">Title: </label>
        <input type="text" name="title" id="title" />

        <button onclick="handleSubmit(event)">SUBMIT</button>
      </form>
      <input
        id="imageUpload"
        type="file"
        accept=".jpg, .png, .jpeg"
        onChange="onChangeImageHandler(event)"
      />
      <img
        id="preview"
        height="200"
        src="https://i.ibb.co/2dtXpf2/blank-avatar.webp"
        alt="preview"
      />
    </div>

    <script>
      const preview = document.getElementById("preview");
      const imageData = document.getElementById("imageUpload");

      //selected image handler
      const onChangeImageHandler = (event) => {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function (e) {
          // as soon as the file is loaded from machine to browser log the result.
          const imageData = e.target.result;
          console.log(reader.result);
          //   console.log(imageData);
          preview.src = imageData;
          //   imageDataInput.value = imageData.split("base64,")[1];
        };
      };

      const handleSubmit = (e) => {
        e.preventDefault();

        console.log("submitting image");

        const postdata = JSON.stringify({
          base64string: preview.src.split("base64,")[1],
          title: title.value,
        });
        console.log(postdata);

        const url = "http://localhost:3000/imageupload";

        const xhr = new XMLHttpRequest();

        xhr.addEventListener("readystatechange", function () {
          if (this.readyState === 4) {
            console.log("eventlistener thingyyyyyyyyyy");
            console.log(this.responseText);
          }
        });

        xhr.open("POST", url, true);

        xhr.setRequestHeader("content-type", "application/json");

        xhr.onload = function () {
          console.log("onload thing happened!!!!!!!!!!");
        };

        xhr.send(postdata);
      };

      //   const handleSubmit = (e) => {
      //     e.preventDefault();

      //     console.log("submitting image");

      //     const postdata = JSON.stringify({
      //       base64string: previewUrl.split("base64,")[1],
      //     });

      //     const url = "http://localhost:8080/imageupload";

      //     const xhr = new XMLHttpRequest();

      //     xhr.addEventListener("readystatechange", function () {
      //       if (this.readyState === 4) {
      //         console.log("eventlistener thingyyyyyyyyyy");
      //         console.log(this.responseText);
      //       }
      //     });

      //     xhr.open("POST", url, true);

      //     xhr.setRequestHeader("content-type", "application/json");

      //     xhr.onload = function () {
      //       console.log("onload thing happened!!!!!!!!!!");
      //     };
      //     xhr.send(postdata);
      //   };
    </script>
  </body>
</html>